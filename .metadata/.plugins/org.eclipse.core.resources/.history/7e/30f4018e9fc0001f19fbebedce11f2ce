import network._;

class Account (accessDevice : AccessDevice, accountId : Int) {

	
	val concession : Concession = new Concession()
	
	var balance : Int = 0
	var status = AccountStatus.Enabled
	var travelHistory : List[TravelRecord] = List()

	var userEntryPoint: EntryPoint = _
	
	def setBalance (amount : Int){ balance = amount}

	def getBalance():Int = balance
	
	def addToBalance (amount : Int) {balance += amount}
	def subtractFromBalance (amount : Int) {balance -= amount}
	
	def startTrip (entryPoint : EntryPoint):Boolean = {
		var successful : Boolean = false;
		if (Network.routeStartsWith(entryPoint)
				&& userEntryPoint == null
				&& balance >= constants.MINBALANCE + constants.PENALTYFARE
				&& status == AccountStatus.Enabled) {
			userEntryPoint = entryPoint
			successful = true
		}
		
		return successful
	}
	def endTrip (exitPoint : ExitPoint) = {
		var successful : Boolean = false;
		val route = userEntryPoint -> ExitPoint
		if (Network.routes.contains(route)
				&& usersFare(route) <= (balance - minbalance)
				&& status == AccountStatus.Enabled) {
			
			travelHistory += TravelRecordFactory(route, usersFare(route))
			balance -= usersFare(route)
		}
	}
	
	def usersFare(EntryPoint->ExitPoint): Int = {
		return (Network.fare(route) + concession.rate)
	}
}